# Nx Witness è‡ªå‹•åŒ–æ¸¬è©¦æ¡†æ¶æ¶æ§‹åœ–

## ğŸ“ æ•´é«”æ¶æ§‹åœ–

```mermaid
graph TB
    subgraph "æ¸¬è©¦å®šç¾©å±¤"
        A1[Excel TestPlan.xlsx]
        A2[TestDir å·¥ä½œè¡¨]
        A3[TestPlan å·¥ä½œè¡¨]
        A4[Translate å·¥ä½œè¡¨]
        A5[Test Case Launcher GUI]
        A1 --> A2
        A1 --> A3
        A1 --> A4
        A5 --> A1
    end

    subgraph "æ¸¬è©¦åŸ·è¡Œå±¤"
        B1[test_case_launcher.py<br/>GUIå•Ÿå‹•å™¨]
        B2[test_runner.py<br/>pytesté‹è¡Œå™¨]
        B3[AppiumManager<br/>Appiumæœå‹™ç®¡ç†]
        B1 --> B2
        B1 --> B3
    end

    subgraph "æ¸¬è©¦å¼•æ“å±¤ engine/"
        C1[testplan_loader.py<br/>åŠ è¼‰æ¸¬è©¦è¨ˆåŠƒ]
        C2[step_translator.py<br/>æµç¨‹ç¿»è­¯å™¨]
        C3[runtime.py<br/>é‹è¡Œæ™‚åŸ·è¡Œ]
        C4[test_reporter.py<br/>å ±å‘Šç”Ÿæˆ]
        C1 --> C2
        C2 --> C3
        C3 --> C4
    end

    subgraph "æ¥­å‹™é‚è¼¯å±¤ actions/"
        D1[nx_poc_actions.py<br/>æ¡Œé¢/ç¶²é ç«¯æ“ä½œ]
        D2[nx_mobile_actions.py<br/>ç§»å‹•ç«¯æ“ä½œ]
        D3[login_actions.py]
        D4[settings_actions.py]
        D5[nx_web_actions.py]
    end

    subgraph "é é¢å°è±¡å±¤ pages/"
        E1[desktop/<br/>æ¡Œé¢é é¢å°è±¡]
        E2[web/<br/>ç¶²é é é¢å°è±¡]
        E3[mobile/<br/>ç§»å‹•é é¢å°è±¡]
    end

    subgraph "åŸºç¤æŠ½è±¡å±¤ base/"
        F1[desktop_app.py<br/>æ¡Œé¢åŸºç¤æ“ä½œ]
        F2[browser.py<br/>ç€è¦½å™¨åŸºç¤æ“ä½œ]
        F3[platform_driver.py<br/>å¹³å°é©…å‹•æŠ½è±¡]
        F4[base_page.py<br/>åŸºç¤é é¢é¡]
        F5[base_action.py<br/>åŸºç¤å‹•ä½œé¡]
        F6[vlm_recognizer.py<br/>è¦–è¦ºè­˜åˆ¥]
        F7[ok_script_recognizer.py<br/>OCRè­˜åˆ¥]
    end

    subgraph "å·¥å…·å±¤ toolkit/"
        G1[logger.py<br/>æ—¥èªŒç³»çµ±]
        G2[datatable.py<br/>æ•¸æ“šè¡¨ç®¡ç†]
        G3[mobile_toolkit.py<br/>ç§»å‹•ç«¯å·¥å…·]
        G4[web_toolkit.py<br/>ç¶²é å·¥å…·]
        G5[xpath.py<br/>XPathå·¥å…·]
    end

    subgraph "é…ç½®å±¤"
        H1[config.py<br/>å¤šç’°å¢ƒé…ç½®]
        H2[EnvConfig<br/>DEV/SIT/UAT/PROD]
    end

    subgraph "è³‡æºå±¤"
        I1[res/<br/>åœ–ç‰‡è³‡æº]
        I2[assets/<br/>å­—é«”è³‡æº]
    end

    subgraph "å ±å‘Šå±¤"
        J1[report/<br/>HTMLå ±å‘Š]
        J2[report/<br/>æˆªåœ–]
        J3[report/<br/>æ—¥èªŒ]
    end

    A5 --> B1
    B2 --> C1
    C3 --> D1
    C3 --> D2
    D1 --> E1
    D1 --> E2
    D2 --> E3
    E1 --> F1
    E2 --> F2
    E3 --> F3
    F1 --> F4
    F2 --> F4
    F3 --> F4
    F1 --> F6
    F1 --> F7
    D1 --> G1
    D2 --> G1
    C1 --> G2
    E3 --> G3
    E2 --> G4
    H1 --> H2
    F1 --> I1
    F6 --> I1
    C4 --> J1
    C4 --> J2
    G1 --> J3
```

## ğŸ”„ åŸ·è¡Œæµç¨‹åœ–

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ¶
    participant Launcher as Test Case Launcher
    participant Runner as test_runner.py
    participant Loader as testplan_loader
    participant Translator as step_translator
    participant Action as Actions
    participant Page as Pages
    participant Base as Base Layer
    participant Driver as Platform Driver
    participant Reporter as test_reporter

    User->>Launcher: é¸æ“‡æ¸¬è©¦æ¡ˆä¾‹ä¸¦å•Ÿå‹•
    Launcher->>Runner: åŸ·è¡Œ pytest
    Runner->>Loader: åŠ è¼‰ Excel æ¸¬è©¦è¨ˆåŠƒ
    Loader-->>Runner: è¿”å›æ­¥é©Ÿåˆ—è¡¨
    
    loop æ¯å€‹æ¸¬è©¦æ­¥é©Ÿ
        Runner->>Translator: åŸ·è¡Œ FlowName
        Translator->>Action: èª¿ç”¨å°æ‡‰ Action æ–¹æ³•
        Action->>Page: èª¿ç”¨é é¢å°è±¡æ–¹æ³•
        Page->>Base: èª¿ç”¨åŸºç¤æ“ä½œæ–¹æ³•
        Base->>Driver: åŸ·è¡Œå¹³å°ç‰¹å®šæ“ä½œ
        Driver-->>Base: è¿”å›çµæœ
        Base-->>Page: è¿”å›çµæœ
        Page-->>Action: è¿”å›çµæœ
        Action-->>Translator: è¿”å›çµæœ
        Translator-->>Runner: è¿”å›çµæœ
    end
    
    Runner->>Reporter: ç”Ÿæˆæ¸¬è©¦å ±å‘Š
    Reporter-->>User: è¿”å›å ±å‘Šè·¯å¾‘
```

## ğŸ—ï¸ åˆ†å±¤æ¶æ§‹è©³è§£

### 1. æ¸¬è©¦å®šç¾©å±¤
- **Excel TestPlan.xlsx**: åŒ…å«æ‰€æœ‰æ¸¬è©¦å®šç¾©
  - `TestDir`: æ¸¬è©¦æ¡ˆä¾‹ç›®éŒ„ï¼Œæ˜ å°„ TestName åˆ°å·¥ä½œè¡¨
  - `TestPlan`: æ¸¬è©¦æ­¥é©Ÿå®šç¾©ï¼ˆStepNo, FlowName, Paramsï¼‰
  - `Translate`: æµç¨‹åç¨±åˆ° Action æ–¹æ³•çš„æ˜ å°„
- **Test Case Launcher**: GUI ç•Œé¢ï¼Œç”¨æ–¼é¸æ“‡å’ŒåŸ·è¡Œæ¸¬è©¦

### 2. æ¸¬è©¦åŸ·è¡Œå±¤
- **test_case_launcher.py**: 
  - æä¾› GUI ç•Œé¢
  - ç®¡ç† Appium Server å•Ÿå‹•/åœæ­¢
  - å¤šç·šç¨‹åŸ·è¡Œæ¸¬è©¦
- **test_runner.py**: pytest æ¸¬è©¦é‹è¡Œå™¨ï¼ŒåŸ·è¡Œæ¸¬è©¦é‚è¼¯

### 3. æ¸¬è©¦å¼•æ“å±¤
- **testplan_loader.py**: å¾ Excel åŠ è¼‰æ¸¬è©¦è¨ˆåŠƒ
- **step_translator.py**: å°‡ FlowName ç¿»è­¯ç‚º Action æ–¹æ³•èª¿ç”¨
- **runtime.py**: åŸ·è¡Œæ¸¬è©¦æ­¥é©Ÿçš„é‹è¡Œæ™‚ç’°å¢ƒ
- **test_reporter.py**: ç”Ÿæˆ HTML æ¸¬è©¦å ±å‘Š

### 4. æ¥­å‹™é‚è¼¯å±¤
- **nx_poc_actions.py**: æ¡Œé¢/ç¶²é ç«¯æ¥­å‹™æ“ä½œï¼ˆç™»å…¥ã€è¨­ç½®ã€éŒ„å½±ç­‰ï¼‰
- **nx_mobile_actions.py**: ç§»å‹•ç«¯æ¥­å‹™æ“ä½œ
- **nx_web_actions.py**: ç¶²é ç«¯ç‰¹å®šæ“ä½œ
- **login_actions.py**: ç™»å…¥ç›¸é—œæ“ä½œ
- **settings_actions.py**: è¨­ç½®ç›¸é—œæ“ä½œ

### 5. é é¢å°è±¡å±¤
- **desktop/**: æ¡Œé¢æ‡‰ç”¨é é¢å°è±¡
  - `login_page.py`, `main_page.py`, `settings_page.py` ç­‰
- **web/**: ç¶²é é é¢å°è±¡
  - `nx_cloud_web_page.py` ç­‰
- **mobile/**: ç§»å‹•æ‡‰ç”¨é é¢å°è±¡
  - `login_page.py`, `main_page.py`, `playback_page.py` ç­‰

### 6. åŸºç¤æŠ½è±¡å±¤
- **desktop_app.py**: æ¡Œé¢æ‡‰ç”¨åŸºç¤æ“ä½œï¼ˆé»æ“Šã€è¼¸å…¥ã€è¦–çª—ç®¡ç†ç­‰ï¼‰
- **browser.py**: ç€è¦½å™¨åŸºç¤æ“ä½œï¼ˆSelenium WebDriver å°è£ï¼‰
- **platform_driver.py**: å¹³å°é©…å‹•æŠ½è±¡æ¥å£
- **base_page.py**: é é¢å°è±¡åŸºç¤é¡
- **base_action.py**: å‹•ä½œåŸºç¤é¡
- **vlm_recognizer.py**: è¦–è¦ºèªè¨€æ¨¡å‹è­˜åˆ¥å™¨
- **ok_script_recognizer.py**: OCR æ–‡å­—è­˜åˆ¥å™¨

### 7. å·¥å…·å±¤
- **logger.py**: çµ±ä¸€æ—¥èªŒç³»çµ±
- **datatable.py**: Excel æ•¸æ“šè¡¨ç®¡ç†
- **mobile_toolkit.py**: ç§»å‹•ç«¯å·¥å…·ï¼ˆAppium WebDriver åˆå§‹åŒ–ï¼‰
- **web_toolkit.py**: ç¶²é å·¥å…·
- **xpath.py**: XPath å·¥å…·å‡½æ•¸

### 8. é…ç½®å±¤
- **config.py**: å¤šç’°å¢ƒé…ç½®ç®¡ç†
  - `EnvConfig`: ç’°å¢ƒé…ç½®é¡
  - æ”¯æ´ DEV/SIT/UAT/PROD ç’°å¢ƒåˆ‡æ›
  - ç®¡ç†å¹³å°ç‰¹å®šé…ç½®ï¼ˆDesktop/Web/Mobileï¼‰

## ğŸŒ å¹³å°æ”¯æ´æ¶æ§‹

```mermaid
graph LR
    subgraph "å¹³å°æŠ½è±¡"
        A[Platform Driver]
    end
    
    subgraph "æ¡Œé¢å¹³å°"
        B[Desktop App<br/>pyautogui + pygetwindow]
    end
    
    subgraph "ç¶²é å¹³å°"
        C[Web Browser<br/>Selenium WebDriver]
    end
    
    subgraph "ç§»å‹•å¹³å°"
        D[Android App<br/>Appium + UiAutomator2]
        E[iOS App<br/>Appium + XCUITest<br/>é ç•™æ¥å£]
    end
    
    A --> B
    A --> C
    A --> D
    A --> E
```

## ğŸ”§ ç’°å¢ƒé…ç½®æ¶æ§‹

```mermaid
graph TB
    subgraph "é…ç½®ç®¡ç†"
        A[config.py]
        B[EnvConfig é¡]
    end
    
    subgraph "ç’°å¢ƒé¡å‹"
        C[DEV<br/>é–‹ç™¼ç’°å¢ƒ]
        D[SIT<br/>ç³»çµ±æ•´åˆæ¸¬è©¦]
        E[UAT<br/>ç”¨æˆ¶é©—æ”¶æ¸¬è©¦]
        F[PROD<br/>ç”Ÿç”¢ç’°å¢ƒ]
    end
    
    subgraph "é…ç½®å…§å®¹"
        G[æœå‹™å™¨åœ°å€]
        H[ç”¨æˆ¶æ†‘è­‰]
        I[å¹³å°é…ç½®]
        J[è¶…æ™‚è¨­ç½®]
    end
    
    A --> B
    B --> C
    B --> D
    B --> E
    B --> F
    B --> G
    B --> H
    B --> I
    B --> J
```

## ğŸ“Š æ•¸æ“šæµå‘åœ–

```mermaid
flowchart TD
    Start([é–‹å§‹æ¸¬è©¦]) --> LoadExcel[åŠ è¼‰ Excel TestPlan]
    LoadExcel --> ParseTestDir[è§£æ TestDir å·¥ä½œè¡¨]
    ParseTestDir --> GetTestName[ç²å–æ¸¬è©¦æ¡ˆä¾‹åç¨±]
    GetTestName --> LoadTestPlan[åŠ è¼‰å°æ‡‰ TestPlan å·¥ä½œè¡¨]
    LoadTestPlan --> ParseSteps[è§£ææ¸¬è©¦æ­¥é©Ÿ]
    ParseSteps --> LoopSteps{é‚„æœ‰æ­¥é©Ÿ?}
    LoopSteps -->|æ˜¯| GetFlowName[ç²å– FlowName]
    GetFlowName --> TranslateFlow[æŸ¥è©¢ Translate å·¥ä½œè¡¨]
    TranslateFlow --> GetAction[ç²å– Action æ–¹æ³•]
    GetAction --> ParseParams[è§£æåƒæ•¸]
    ParseParams --> ExecuteAction[åŸ·è¡Œ Action]
    ExecuteAction --> CallPage[èª¿ç”¨ Page æ–¹æ³•]
    CallPage --> CallBase[èª¿ç”¨ Base æ–¹æ³•]
    CallBase --> CallDriver[èª¿ç”¨ Platform Driver]
    CallDriver --> ReturnResult[è¿”å›çµæœ]
    ReturnResult --> LoopSteps
    LoopSteps -->|å¦| GenerateReport[ç”Ÿæˆæ¸¬è©¦å ±å‘Š]
    GenerateReport --> End([çµæŸ])
```

## ğŸ¯ æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

1. **åˆ†å±¤æ¶æ§‹**: æ¸…æ™°çš„è·è²¬åˆ†é›¢ï¼Œæ¯å±¤åªé—œæ³¨è‡ªå·±çš„è·è²¬
2. **Excel é©…å‹•**: æ¸¬è©¦æµç¨‹å®šç¾©åœ¨ Excelï¼Œä»£ç¢¼åªè² è²¬åŸ·è¡Œ
3. **å¤šå¹³å°æ”¯æ´**: çµ±ä¸€çš„æ¥å£ï¼Œæ”¯æ´ Desktop/Web/Mobile
4. **å¤šç’°å¢ƒé…ç½®**: æ”¯æ´å¤šç’°å¢ƒåˆ‡æ›ï¼Œç„¡éœ€ä¿®æ”¹ä»£ç¢¼
5. **å¯æ“´å±•æ€§**: æ–°å¢å¹³å°æˆ–åŠŸèƒ½åªéœ€æ“´å±•å°æ‡‰å±¤ç´š
6. **å¯ç¶­è­·æ€§**: æ¥­å‹™é‚è¼¯èˆ‡æŠ€è¡“å¯¦ç¾åˆ†é›¢

## ğŸ“ é—œéµæ–‡ä»¶èªªæ˜

| æ–‡ä»¶/ç›®éŒ„ | è·è²¬ | é—œéµé¡/å‡½æ•¸ |
|---------|------|-----------|
| `test_case_launcher.py` | GUI å•Ÿå‹•å™¨ | `TestCaseLauncher`, `AppiumManager` |
| `tests/test_runner.py` | pytest é‹è¡Œå™¨ | `get_test_data()`, `test_main_flow()` |
| `engine/testplan_loader.py` | åŠ è¼‰æ¸¬è©¦è¨ˆåŠƒ | `load_test_plan()` |
| `engine/step_translator.py` | æµç¨‹ç¿»è­¯ | `StepTranslator.execute()` |
| `engine/runtime.py` | é‹è¡Œæ™‚åŸ·è¡Œ | åŸ·è¡Œæ¸¬è©¦æ­¥é©Ÿ |
| `engine/test_reporter.py` | å ±å‘Šç”Ÿæˆ | ç”Ÿæˆ HTML å ±å‘Š |
| `actions/nx_poc_actions.py` | æ¡Œé¢/ç¶²é æ¥­å‹™é‚è¼¯ | `NxPocActions` |
| `actions/nx_mobile_actions.py` | ç§»å‹•ç«¯æ¥­å‹™é‚è¼¯ | `NxMobileActions` |
| `base/desktop_app.py` | æ¡Œé¢åŸºç¤æ“ä½œ | `DesktopApp` |
| `base/browser.py` | ç€è¦½å™¨åŸºç¤æ“ä½œ | `Browser` |
| `base/platform_driver.py` | å¹³å°é©…å‹•æŠ½è±¡ | `PlatformDriver` |
| `toolkit/mobile_toolkit.py` | ç§»å‹•ç«¯å·¥å…· | `create_appium_driver()` |
| `config.py` | é…ç½®ç®¡ç† | `EnvConfig` |

---

**æœ€å¾Œæ›´æ–°**: 2026-01-23  
**æ¶æ§‹ç‰ˆæœ¬**: v2.0
